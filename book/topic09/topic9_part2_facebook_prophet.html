

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Topic 9. Time series analysis in Python. Part 2. Predicting the future with Facebook Prophet &#8212; mlcourse.ai</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://c6.patreon.com/becomePatronButton.bundle.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-CN7ZN59CQB"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-CN7ZN59CQB');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/topic09/topic9_part2_facebook_prophet';</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Videolecture 9. Time series: ARIMA and Prophet" href="videolecture09.html" />
    <link rel="prev" title="Topic 9. Part 1. Time series analysis in Python" href="topic9_part1_time_series_python.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/mlcourse_ai_logo.jpg" class="logo__image only-light" alt="mlcourse.ai - Home"/>
    <script>document.write(`<img src="../../_static/mlcourse_ai_logo.jpg" class="logo__image only-dark" alt="mlcourse.ai - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Intro
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Prerequisites</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../prereqs/python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prereqs/math.html">Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prereqs/software_devops.html">Software &amp; DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prereqs/docker.html">Docker</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic01/topic01_intro.html">Topic 1 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic01/topic01_pandas_data_analysis.html">Exploratory data analysis with Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic01/videolecture01.html">Videolecture 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic01/assignment01_pandas_uci_adult.html">Demo Assignment 1 Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic01/assignment01_pandas_uci_adult_solution.html">Demo Assignment 1 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic01/bonus_assignment01_pandas_olympics.html">Bonus Assignment 1</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic02/topic02_intro.html">Topic 2 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic02/topic02_visual_data_analysis.html">Visual Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic02/topic02_additional_seaborn_matplotlib_plotly.html">Seaborn, Matplotlib, Plotly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic02/videolecture02.html">Videolecture 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic02/assignment02_analyzing_cardiovascular_desease_data.html">Demo Assignment 2 Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic02/assignment02_analyzing_cardiovascular_desease_data_solution.html">Demo Assignment 2 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic02/bonus_assignment02_visual_analysis.html">Bonus Assignment 2</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic03/topic03_intro.html">Topic 3 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic03/topic03_decision_trees_kNN.html">Classification, Decision Trees &amp; k Nearest Neighbors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic03/videolecture03.html">Videolecture 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic03/assignment03_decision_trees.html">Demo Assignment 3 Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic03/assignment03_decision_trees_solution.html">Demo Assignment 3 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic03/bonus_assignment03_decision_trees.html">Bonus Assignment 3</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic04/topic04_intro.html">Topic 4 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/topic4_linear_models_part1_mse_likelihood_bias_variance.html">Ordinary Least Squares</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/topic4_linear_models_part2_logit_likelihood_learning.html">Linear classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/topic4_linear_models_part3_regul_example.html">An illustrative example of logistic regression regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/topic4_linear_models_part4_good_bad_logit_movie_reviews_XOR.html">When logistic regression is good and when it is not</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/topic4_linear_models_part5_valid_learning_curves.html">Validation and learning curves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/videolecture04.html">Videolecture 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/assignment04_regression_wine.html">Demo Assignment 4 Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/assignment04_regression_wine_solution.html">Demo Assignment 4 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic04/bonus_assignment04_alice_baselines.html">Bonus Assignment 4</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic05/topic05_intro.html">Topic 5 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/topic5_part1_bagging.html">Bagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/topic5_part2_random_forest.html">Random Forest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/topic5_part3_feature_importance.html">Feature importance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/videolecture05.html">Videolecture 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/assignment05_logit_rf_credit_scoring.html">Demo Assignment 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/assignment05_logit_rf_credit_scoring_solution.html">Demo Assignment 5 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic05/bonus_assignment05_logreg_rf.html">Bonus Assignment 5</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic06/topic06_intro.html">Topic 6 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic06/topic6_feature_engineering_feature_selection.html">Feature engineering &amp; feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic06/demo_assignment06.html">Demo Assignment 6 Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic06/bonus_assignment06.html">Bonus Assignment 6</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic07/topic07_intro.html">Topic 7 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic07/topic7_pca_clustering.html">Unsupervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic07/videolecture07.html">Videolecture 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic07/assignment07_unsupervised_learning.html">Demo Assignment 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic07/assignment07_unsupervised_learning_solution.html">Demo Assignment 7 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic07/bonus_assignment07.html">Bonus Assignment 7</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 8</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic08/topic08_intro.html">Topic 8 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic08/topic08_sgd_hashing_vowpal_wabbit.html">Vowpal Wabbit: Learning with Gigabytes of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic08/videolecture08.html">Videolecture 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic08/assignment08_implement_sgd_regressor.html">Demo Assignment 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic08/assignment08_implement_sgd_regressor_solution.html">Demo Assignment 8 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic08/bonus_assignment08.html">Bonus Assignment 8</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 9</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="topic09_intro.html">Topic 9 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="topic9_part1_time_series_python.html">Topic 9. Part 1. Time series analysis in Python</a></li>







<li class="toctree-l1 current active"><a class="current reference internal" href="#">Predicting the future with Facebook Prophet</a></li>
<li class="toctree-l1"><a class="reference internal" href="videolecture09.html">Videolecture 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment09_time_series.html">Demo Assignment 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment09_time_series_solution.html">Demo Assignment 9 Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonus_assignment09.html">Bonus Assignment 9</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topic 10</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topic10/topic10_intro.html">Topic 10 Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic10/topic10_gradient_boosting.html">Gradient boosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic10/videolecture10.html">Videolecture 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic10/assignment10_flight_delays_kaggle.html">Demo Assignment 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic10/bonus_assignment10.html">Bonus Assignment 10</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About the course</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../extra/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/rating.html">Rating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/contributors.html">Contributors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Yorko/mlcourse.ai" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Yorko/mlcourse.ai/edit/main/mlcourse_ai_jupyter_book/book/topic09/topic9_part2_facebook_prophet.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Yorko/mlcourse.ai/issues/new?title=Issue%20on%20page%20%2Fbook/topic09/topic9_part2_facebook_prophet.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/book/topic09/topic9_part2_facebook_prophet.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Topic 9. Time series analysis in Python. Part 2. Predicting the future with Facebook Prophet</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#article-outline">Article outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prophet-forecasting-model">2. The Prophet Forecasting Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trend">Trend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality">Seasonality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holidays-and-events">Holidays and Events</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error">Error</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prophet-benchmarking">Prophet Benchmarking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-with-facebook-prophet">3. Practice with Facebook Prophet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-in-python">3.1 Installation in Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">3.2 Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-visual-analysis">3.3 Exploratory visual analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-a-forecast">3.4 Making a forecast</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecast-quality-evaluation">3.5 Forecast quality evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">3.6 Visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#box-cox-transformation">4. Box-Cox Transformation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5. Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">6. References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="topic-9-time-series-analysis-in-python-part-2-predicting-the-future-with-facebook-prophet">
<span id="topic09-part2"></span><h1><a class="toc-backref" href="#id1" role="doc-backlink">Topic 9. Time series analysis in Python. Part 2. Predicting the future with Facebook Prophet</a><a class="headerlink" href="#topic-9-time-series-analysis-in-python-part-2-predicting-the-future-with-facebook-prophet" title="Permalink to this heading">#</a></h1>
<img src="https://habrastorage.org/webt/ia/m9/zk/iam9zkyzqebnf_okxipihkgjwnw.jpeg" />
<p><strong><center><a class="reference external" href="https://mlcourse.ai">mlcourse.ai</a> – Open Machine Learning Course</strong> </center><br>
Author: <a class="reference external" href="https://www.linkedin.com/in/egor-polusmak/">Egor Polusmak</a>. Translated and edited by <a class="reference external" href="https://www.linkedin.com/in/yuanyuanpao/">Yuanyuan Pao</a>. This material is subject to the terms and conditions of the <a class="reference external" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons CC BY-NC-SA 4.0</a> license. Free use is permitted for any non-commercial purpose.</p>
<p>Time series forecasting finds wide application in data analytics. These are only some of the conceivable predictions of future trends that might be useful:</p>
<ul class="simple">
<li><p>The number of servers that an online service will need next year.</p></li>
<li><p>The demand for a grocery product at a supermarket on a given day.</p></li>
<li><p>The tomorrow closing price of a tradable financial asset.</p></li>
</ul>
<p>For another example, we can make a prediction of some team’s performance and then use it as a baseline: first to set goals for the team, and then to measure the actual team performance relative to the baseline.</p>
<p>There are quite a few different methods to predict future trends, for example, <a class="reference external" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average">ARIMA</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity">ARCH</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Autoregressive_model">regressive models</a>, <a class="reference external" href="https://medium.com/machine-learning-world/neural-networks-for-algorithmic-trading-1-2-correct-time-series-forecasting-backtesting-9776bfd9e589">neural networks</a>.</p>
<p>In this article, we will look at <a class="reference external" href="https://facebook.github.io/prophet/">Prophet</a>, a library for time series forecasting released by Facebook and open-sourced on February 23, 2017. We will also try it out in the problem of predicting the daily number of posts published on Medium.</p>
<section id="article-outline">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Article outline</a><a class="headerlink" href="#article-outline" title="Permalink to this heading">#</a></h2>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#topic-9-time-series-analysis-in-python-part-2-predicting-the-future-with-facebook-prophet" id="id1">Topic 9. Time series analysis in Python. Part 2. Predicting the future with Facebook Prophet</a></p>
<ul>
<li><p><a class="reference internal" href="#article-outline" id="id2">Article outline</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id3">1. Introduction</a></p></li>
<li><p><a class="reference internal" href="#the-prophet-forecasting-model" id="id4">2. The Prophet Forecasting Model</a></p>
<ul>
<li><p><a class="reference internal" href="#trend" id="id5">Trend</a></p></li>
<li><p><a class="reference internal" href="#seasonality" id="id6">Seasonality</a></p></li>
<li><p><a class="reference internal" href="#holidays-and-events" id="id7">Holidays and Events</a></p></li>
<li><p><a class="reference internal" href="#error" id="id8">Error</a></p></li>
<li><p><a class="reference internal" href="#prophet-benchmarking" id="id9">Prophet Benchmarking</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#practice-with-facebook-prophet" id="id10">3. Practice with Facebook Prophet</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-in-python" id="id11">3.1 Installation in Python</a></p></li>
<li><p><a class="reference internal" href="#dataset" id="id12">3.2 Dataset</a></p></li>
<li><p><a class="reference internal" href="#exploratory-visual-analysis" id="id13">3.3 Exploratory visual analysis</a></p></li>
<li><p><a class="reference internal" href="#making-a-forecast" id="id14">3.4 Making a forecast</a></p></li>
<li><p><a class="reference internal" href="#forecast-quality-evaluation" id="id15">3.5 Forecast quality evaluation</a></p></li>
<li><p><a class="reference internal" href="#visualization" id="id16">3.6 Visualization</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#box-cox-transformation" id="id17">4. Box-Cox Transformation</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id18">5. Summary</a></p></li>
<li><p><a class="reference internal" href="#references" id="id19">6. References</a></p></li>
</ul>
</li>
</ul>
</nav>
</section>
<section id="introduction">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>According to the <a class="reference external" href="https://facebook.github.io/prophet/static/prophet_paper_20170113.pdf">article</a> by Facebook Research, Prophet was initially developed for the purpose of creating high quality business forecasts. This library tries to address the following difficulties common to many business time series:</p>
<ul class="simple">
<li><p>Seasonal effects caused by human behavior: weekly, monthly and yearly cycles, dips and peaks on public holidays.</p></li>
<li><p>Changes in trend due to new products and market events.</p></li>
<li><p>Outliers.</p></li>
</ul>
<p>The authors claim that, even with the default settings, in many cases, their library produces forecasts as accurate as those delivered by experienced analysts.</p>
<p>Moreover, Prophet has a number of intuitive and easily interpretable customizations that allow gradually improving the quality of the forecasting model. What is especially important, these parameters are quite comprehensible even for non-experts in time series analysis, which is a field of data science requiring certain skill and experience.</p>
<p>By the way, the original article is called “Forecasting at Scale”, but it is not about the scale in the “usual” sense, that is addressing computational and infrastructure problems of a large number of working programs. According to the authors, Prophet should scale well in the following 3 areas:</p>
<ul class="simple">
<li><p>Accessibility to a wide audience of analysts, possibly without profound expertise in time series.</p></li>
<li><p>Applicability to a wide range of distinct forecasting problems.</p></li>
<li><p>Automated performance estimation of a large number of forecasts including flagging of potential problems for their subsequent inspection by the analyst.</p></li>
</ul>
</section>
<section id="the-prophet-forecasting-model">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">2. The Prophet Forecasting Model</a><a class="headerlink" href="#the-prophet-forecasting-model" title="Permalink to this heading">#</a></h2>
<p>Now, let’s take a closer look at how Prophet works. In its essence, this library utilizes the <a class="reference external" href="https://en.wikipedia.org/wiki/Additive_model">additive regression model</a> <span class="math notranslate nohighlight">\(y(t)\)</span> comprising the following components:</p>
<div class="math notranslate nohighlight">
\[y(t) = g(t) + s(t) + h(t) + \epsilon_{t},\]</div>
<p>where:</p>
<ul class="simple">
<li><p>Trend <span class="math notranslate nohighlight">\(g(t)\)</span> models non-periodic changes.</p></li>
<li><p>Seasonality <span class="math notranslate nohighlight">\(s(t)\)</span> represents periodic changes.</p></li>
<li><p>Holidays component <span class="math notranslate nohighlight">\(h(t)\)</span> contributes information about holidays and events.</p></li>
</ul>
<p>Below, we will consider some important properties of these model components.</p>
<section id="trend">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Trend</a><a class="headerlink" href="#trend" title="Permalink to this heading">#</a></h3>
<p>The Prophet library implements two possible trend models for <span class="math notranslate nohighlight">\(g(t)\)</span>.</p>
<p>The first one is called <em>Nonlinear, Saturating Growth</em>. It is represented in the form of the <a class="reference external" href="https://en.wikipedia.org/wiki/Logistic_function">logistic growth model</a>:</p>
<div class="math notranslate nohighlight">
\[g(t) = \frac{C}{1+e^{-k(t - m)}},\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(C\)</span> is the carrying capacity (that is the curve’s maximum value).</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span> is the growth rate (which represents “the steepness” of the curve).</p></li>
<li><p><span class="math notranslate nohighlight">\(m\)</span> is an offset parameter.</p></li>
</ul>
<p>This logistic equation allows modelling non-linear growth with saturation, that is when the growth rate of a value decreases with its growth. One of the typical examples would be representing the growth of the audience of an application or a website.</p>
<p>Actually, <span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(k\)</span> are not necessarily constants and may vary over time. Prophet supports both automatic and manual tuning of their variability. The library can itself choose optimal points of trend changes by fitting the supplied historical data.</p>
<p>Also, Prophet allows analysts to manually set changepoints of the growth rate and capacity values at different points in time. For instance, analysts may have insights about dates of past releases that prominently influenced some key product indicators.</p>
<p>The second trend model is a simple <em>Piecewise Linear Model</em> with a constant rate of growth. It is best suited for problems without saturating growth.</p>
</section>
<section id="seasonality">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Seasonality</a><a class="headerlink" href="#seasonality" title="Permalink to this heading">#</a></h3>
<p>The seasonal component <span class="math notranslate nohighlight">\(s(t)\)</span> provides a flexible model of periodic changes due to weekly and yearly seasonality.</p>
<p>Weekly seasonal data is modeled with dummy variables. Six new variables are added: <code class="docutils literal notranslate"><span class="pre">monday</span></code>, <code class="docutils literal notranslate"><span class="pre">tuesday</span></code>, <code class="docutils literal notranslate"><span class="pre">wednesday</span></code>, <code class="docutils literal notranslate"><span class="pre">thursday</span></code>, <code class="docutils literal notranslate"><span class="pre">friday</span></code>, <code class="docutils literal notranslate"><span class="pre">saturday</span></code>, which take values 0 or 1 depending on the day of the week. The feature <code class="docutils literal notranslate"><span class="pre">sunday</span></code> is not added because it would be a linear combination of the other days of the week, and this fact would have an adverse effect on the model.</p>
<p>Yearly seasonality model in Prophet relies on Fourier series.</p>
<p>Since <a class="reference external" href="https://github.com/facebook/prophet">version 0.2</a> you can also use <em>sub-daily time series</em> and make <em>sub-daily forecasts</em> as well as employ the new <em>daily seasonality</em> feature.</p>
</section>
<section id="holidays-and-events">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Holidays and Events</a><a class="headerlink" href="#holidays-and-events" title="Permalink to this heading">#</a></h3>
<p>The component <span class="math notranslate nohighlight">\(h(t)\)</span> represents predictable abnormal days of the year including those on irregular schedules, e.g., Black Fridays.</p>
<p>To utilize this feature, the analyst needs to provide a custom list of events.</p>
</section>
<section id="error">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Error</a><a class="headerlink" href="#error" title="Permalink to this heading">#</a></h3>
<p>The error term <span class="math notranslate nohighlight">\(\epsilon(t)\)</span> represents information that was not reflected in the model. Usually it is modeled as normally distributed noise.</p>
</section>
<section id="prophet-benchmarking">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Prophet Benchmarking</a><a class="headerlink" href="#prophet-benchmarking" title="Permalink to this heading">#</a></h3>
<p>For a detailed description of the model and algorithms behind Prophet refer to the paper <a class="reference external" href="https://peerj.com/preprints/3190/">“Forecasting at scale”</a> by Sean J. Taylor and Benjamin Letham.</p>
<p>The authors also compared their library with several other methods for time series forecasting. They used <a class="reference external" href="https://en.wikipedia.org/wiki/Mean_absolute_percentage_error">Mean Absolute Percentage Error (MAPE)</a> as a measure of prediction accuracy. In this research, Prophet has shown substantially lower forecasting error than the other models.</p>
<img src="../../_static/img/topic9_benchmarking_prophet.png" />
<p>Let’s look closer at how the forecasting quality was measured in the article. To do this, we will need the formula of Mean Absolute Percentage Error.</p>
<p>Let <span class="math notranslate nohighlight">\(y_{i}\)</span> be the <em>actual (historical) value</em> and <span class="math notranslate nohighlight">\(\hat{y}_{i}\)</span> be the <em>forecast value</em> given by our model.</p>
<p>Then <span class="math notranslate nohighlight">\(e_{i} = y_{i} - \hat{y}_{i}\)</span> is the <em>forecast error</em> and <span class="math notranslate nohighlight">\(p_{i} =\frac{\displaystyle e_{i}}{\displaystyle y_{i}}\)</span> is the <em>relative forecast error</em>.</p>
<p>We define</p>
<div class="math notranslate nohighlight">
\[MAPE = mean\big(\left |p_{i} \right |\big)\]</div>
<p>MAPE is widely used as a measure of prediction accuracy because it expresses error as a percentage and thus can be used in model evaluations on different datasets.</p>
<p>In addition, when evaluating a forecasting algorithm, it may prove useful to calculate <a class="reference external" href="https://en.wikipedia.org/wiki/Mean_absolute_error">MAE (Mean Absolute Error)</a> in order to have a picture of errors in absolute numbers. Using previously defined components, its equation will be</p>
<div class="math notranslate nohighlight">
\[MAE = mean\big(\left |e_{i}\right |\big)\]</div>
<p>A few words about the algorithms that Prophet was compared with. Most of them are quite simple and often are used as a baseline for other models:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">naive</span></code> is a simplistic forecasting approach where we predict all future values relying solely on the observation at the last available point of time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snaive</span></code> (seasonal naive) is a model that makes constant predictions taking into account information about seasonality. For instance, in the case of weekly seasonal data for each future Monday, we would predict the value from the last Monday, and for all future Tuesdays we would use the value from the last Tuesday and so on.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean</span></code> uses the averaged value of data as a forecast.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arima</span></code> stands for <em>Autoregressive Integrated Moving Average</em>, see <a class="reference external" href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average">Wikipedia</a> for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ets</span></code> stands for <em>Exponential Smoothing</em>, see <a class="reference external" href="https://en.wikipedia.org/wiki/Exponential_smoothing">Wikipedia</a> for more.</p></li>
</ul>
</section>
</section>
<section id="practice-with-facebook-prophet">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">3. Practice with Facebook Prophet</a><a class="headerlink" href="#practice-with-facebook-prophet" title="Permalink to this heading">#</a></h2>
<section id="installation-in-python">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">3.1 Installation in Python</a><a class="headerlink" href="#installation-in-python" title="Permalink to this heading">#</a></h3>
<p>First, you need to install the library. Prophet is available for Python and R. The choice will depend on your personal preferences and project requirements. Further in this article we will use Python.</p>
<p>In Python you can install Prophet using PyPI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install fbprophet
</pre></div>
</div>
<p>In R you can find the corresponding CRAN package. Refer to the <a class="reference external" href="https://facebook.github.io/prophet/docs/installation.html">documentation</a> for details.</p>
<p>Let’s import the modules that we will need, and initialize our environment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="c1">#%config InlineBackend.figure_format = &#39;retina&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataset">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">3.2 Dataset</a><a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h3>
<p>We will predict the daily number of posts published on <a class="reference external" href="https://medium.com/">Medium</a>.</p>
<p>First, we load our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">download_file_from_gdrive</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads a file from GDrive given an URL</span>
<span class="sd">    :param file_url: a string formated as https://drive.google.com/uc?id=&lt;file_id&gt;</span>
<span class="sd">    :param: the desired file name</span>
<span class="sd">    :param: the desired folder where the file will be downloaded to</span>
<span class="sd">    :param overwrite: whether to overwrite the file if it already exists</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_exists</span> <span class="o">=</span> <span class="p">(</span><span class="n">out_path</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">file_exists</span> <span class="ow">and</span> <span class="n">overwrite</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">file_exists</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;gdown </span><span class="si">{</span><span class="n">file_url</span><span class="si">}</span><span class="s1"> -O </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FILE_URL</span> <span class="o">=</span> <span class="s2">&quot;https://drive.google.com/uc?id=1et3FfGQzm_lw0AWtZ0125TKKbD6dTwdi&quot;</span>
<span class="n">FILE_NAME</span> <span class="o">=</span> <span class="s2">&quot;medium_posts.csv&quot;</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../../../data/large_files&quot;</span><span class="p">)</span>

<span class="n">download_file_from_gdrive</span><span class="p">(</span><span class="n">file_url</span><span class="o">=</span><span class="n">FILE_URL</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span> <span class="n">FILE_NAME</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="n">DATA_PATH</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">/</span> <span class="n">FILE_NAME</span><span class="p">,</span>  <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we leave out all columns except <code class="docutils literal notranslate"><span class="pre">published</span></code> and <code class="docutils literal notranslate"><span class="pre">url</span></code>. The former corresponds to the time dimension while the latter uniquely identifies a post by its URL. Along the way we get rid of possible duplicates and missing values in the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;published&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we need to convert <code class="docutils literal notranslate"><span class="pre">published</span></code> to the datetime format because by default <code class="docutils literal notranslate"><span class="pre">pandas</span></code> treats this field as string-valued.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;published&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;published&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s sort the dataframe by time and take a look at what we’ve got:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;published&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50931</th>
      <td>1970-01-01 00:00:00.001000+00:00</td>
      <td>https://medium.com/iiot</td>
    </tr>
    <tr>
      <th>40243</th>
      <td>1970-01-01 00:00:00.001000+00:00</td>
      <td>https://medium.com/@ikaella/melon-rebranding-b...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Medium’s public release date was August 15, 2012. But, as you can see from the data above, there are at least several rows with much earlier publication dates. They have somehow turned up in our dataset, but they are hardly legitimate ones. We will just trim our time series to keep only those rows that fall onto the period from August 15, 2012 to June 25, 2017:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;published&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s2">&quot;2012-08-15&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;published&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s2">&quot;2017-06-26&quot;</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;published&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>24630</th>
      <td>2012-08-15 00:25:03.373000+00:00</td>
      <td>https://medium.com/launch-day/jean-attempts-to...</td>
    </tr>
    <tr>
      <th>24631</th>
      <td>2012-08-15 00:25:29.419000+00:00</td>
      <td>https://medium.com/launch-day/dan-and-kristin-...</td>
    </tr>
    <tr>
      <th>17811</th>
      <td>2012-08-15 00:34:59.502000+00:00</td>
      <td>https://medium.com/i-m-h-o/the-world-is-social...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>published</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>62122</th>
      <td>2017-06-25 23:36:01.171000+00:00</td>
      <td>https://medium.com/push-the-pace/the-official-...</td>
    </tr>
    <tr>
      <th>72471</th>
      <td>2017-06-25 23:41:48.295000+00:00</td>
      <td>https://medium.com/parti-xyz-developers/%EA%B4...</td>
    </tr>
    <tr>
      <th>83283</th>
      <td>2017-06-25 23:51:43+00:00</td>
      <td>http://www.johanr.com/blog/people-support-dreams</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As we are going to predict the number of published posts, we will aggregate and count unique posts at each given point in time. We will name the corresponding new column <code class="docutils literal notranslate"><span class="pre">posts</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aggr_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;published&quot;</span><span class="p">)[[</span><span class="s2">&quot;url&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">aggr_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;posts&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>In this practice, we are interested in the number of posts <strong>a day</strong>. But at this moment all our data is divided into irregular time intervals that are less than a day. This is called a <em>sub-daily time series</em>. To see it, let’s print out the first 3 rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aggr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>posts</th>
    </tr>
    <tr>
      <th>published</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-08-15 00:25:03.373000+00:00</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2012-08-15 00:25:29.419000+00:00</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2012-08-15 00:34:59.502000+00:00</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To fix this, we need to aggregate the post counts by “bins” of a date size. In time series analysis, this process is referred to as <em>resampling</em>. And if we <em>reduce</em> the sampling rate of data it is often called <em>downsampling</em>.</p>
<p>Luckily, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> has a built-in functionality for this task. We will resample our time index down to 1-day bins:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">daily_df</span> <span class="o">=</span> <span class="n">aggr_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
<span class="n">daily_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>posts</th>
    </tr>
    <tr>
      <th>published</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-08-15 00:00:00+00:00</th>
      <td>16</td>
    </tr>
    <tr>
      <th>2012-08-16 00:00:00+00:00</th>
      <td>11</td>
    </tr>
    <tr>
      <th>2012-08-17 00:00:00+00:00</th>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="exploratory-visual-analysis">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">3.3 Exploratory visual analysis</a><a class="headerlink" href="#exploratory-visual-analysis" title="Permalink to this heading">#</a></h3>
<p>As always, it may be helpful and instructive to look at a graphical representation of your data.</p>
<p>We will create a time series plot for the whole time range. Displaying data over such a long period of time can give clues about seasonality and conspicuous abnormal deviations.</p>
<p>First, we import and initialize the <code class="docutils literal notranslate"><span class="pre">Plotly</span></code> library, which allows creating beautiful interactive plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">plotly</span><span class="w"> </span><span class="kn">import</span> <span class="n">graph_objs</span> <span class="k">as</span> <span class="n">go</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotly.offline</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">plot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">IFrame</span>

<span class="c1"># Initialize plotly</span>
<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        </div></div>
</div>
<p>We also define a helper function, which will plot our dataframes throughout the article:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plotly_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize all the dataframe columns as line plots.&quot;&quot;&quot;</span>
    <span class="n">common_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">common_kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

    <span class="c1"># in a Jupyter Notebook, the following should work</span>
    <span class="c1">#iplot(fig, show_link=False)</span>

    <span class="c1"># in a Jupyter Book, we save a plot offline and then render it with IFrame</span>
    <span class="n">plot_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../../_static/plotly_htmls/</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">show_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
    <span class="n">display</span><span class="p">(</span><span class="n">IFrame</span><span class="p">(</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try and plot our dataset <em>as is</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotly_df</span><span class="p">(</span><span class="n">daily_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Posts on Medium (daily)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="800"
            height="500"
            src="../../_static/plotly_htmls/Posts_on_Medium_(daily).html"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p>High-frequency data can be rather difficult to analyze. Even with the ability to zoom in provided by <code class="docutils literal notranslate"><span class="pre">Plotly</span></code>, it is hard to infer anything meaningful from this chart apart from the prominent upward and accelerating trend.</p>
<p>To reduce the noise, we will resample the post counts down to weekly bins. Besides <em>binning</em>, other possible techniques of noise reduction include <a class="reference external" href="https://en.wikipedia.org/wiki/Moving_average">Moving-Average Smoothing</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Exponential_smoothing">Exponential Smoothing</a>, among others.</p>
<p>We save our downsampled dataframe in a separate variable because further in this practice we will work only with daily series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weekly_df</span> <span class="o">=</span> <span class="n">daily_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we plot the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotly_df</span><span class="p">(</span><span class="n">weekly_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Posts on Medium (weekly)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="800"
            height="500"
            src="../../_static/plotly_htmls/Posts_on_Medium_(weekly).html"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p>This downsampled chart proves to be somewhat better for an analyst’s perception.</p>
<p>One of the most useful functions that <code class="docutils literal notranslate"><span class="pre">Plotly</span></code> provides is the ability to quickly dive into different periods of timeline in order to better understand the data and find visual clues about possible trends, periodic and irregular effects.</p>
<p>For example, zooming-in on a couple of consecutive years shows us time points corresponding to Christmas holidays, which greatly influence human behaviors.</p>
<p>Now, we’re going to omit the first few years of observations, up to 2015. First, they won’t contribute much into the forecast quality in 2017. Second, these first years, having very low number of posts per day, are likely to increase noise in our predictions, as the model would be forced to fit this abnormal historical data along with more relevant and indicative data from the recent years.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">daily_df</span> <span class="o">=</span> <span class="n">daily_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">daily_df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="s2">&quot;2015-01-01&quot;</span><span class="p">]</span>
<span class="n">daily_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>posts</th>
    </tr>
    <tr>
      <th>published</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00+00:00</th>
      <td>8</td>
    </tr>
    <tr>
      <th>2015-01-02 00:00:00+00:00</th>
      <td>11</td>
    </tr>
    <tr>
      <th>2015-01-03 00:00:00+00:00</th>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To sum up, from visual analysis we can see that our dataset is non-stationary with a prominent growing trend. It also demonstrates weekly and yearly seasonality and a number of abnormal days in each year.</p>
</section>
<section id="making-a-forecast">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">3.4 Making a forecast</a><a class="headerlink" href="#making-a-forecast" title="Permalink to this heading">#</a></h3>
<p>Prophet’s API is very similar to the one you can find in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>. First we create a model, then call the method <code class="docutils literal notranslate"><span class="pre">fit</span></code>, and, finally, make a forecast. The input to the method <code class="docutils literal notranslate"><span class="pre">fit</span></code> is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with two columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ds</span></code> (datestamp) must be of type <code class="docutils literal notranslate"><span class="pre">date</span></code> or <code class="docutils literal notranslate"><span class="pre">datetime</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> is a numeric value we want to predict.</p></li>
</ul>
<p>To get started, we’ll import the library and mute unimportant diagnostic messages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">prophet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Prophet</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s convert our dataframe to the format required by Prophet:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">daily_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
<span class="c1"># converting timezones (issue https://github.com/facebook/prophet/issues/831)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;ds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>904</th>
      <td>2017-06-23</td>
      <td>421</td>
    </tr>
    <tr>
      <th>905</th>
      <td>2017-06-24</td>
      <td>277</td>
    </tr>
    <tr>
      <th>906</th>
      <td>2017-06-25</td>
      <td>253</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The authors of the library generally advise to make predictions based on at least several months, ideally, more than a year of historical data. Luckily, in our case we have more than a couple of years of data to fit the model.</p>
<p>To measure the quality of our forecast, we need to split our dataset into the <em>historical part</em>, which is the first and biggest slice of our data, and the <em>prediction part</em>, which will be located at the end of the timeline. We will remove the last month from the dataset in order to use it later as a prediction target:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction_size</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="o">-</span><span class="n">prediction_size</span><span class="p">]</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>874</th>
      <td>2017-05-24</td>
      <td>375</td>
    </tr>
    <tr>
      <th>875</th>
      <td>2017-05-25</td>
      <td>298</td>
    </tr>
    <tr>
      <th>876</th>
      <td>2017-05-26</td>
      <td>269</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we need to create a new <code class="docutils literal notranslate"><span class="pre">Prophet</span></code> object. Here we can pass the parameters of the model into the constructor. But in this article we will use the defaults. Then we train our model by invoking its <code class="docutils literal notranslate"><span class="pre">fit</span></code> method on our training dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:55:27 - cmdstanpy - INFO - Chain [1] start processing
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:55:27 - cmdstanpy - INFO - Chain [1] done processing
</pre></div>
</div>
</div>
</div>
<p>Using the helper method <code class="docutils literal notranslate"><span class="pre">Prophet.make_future_dataframe</span></code>, we create a dataframe which will contain all dates from the history and also extend into the future for those 30 days that we left out before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">future</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">prediction_size</span><span class="p">)</span>
<span class="n">future</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>904</th>
      <td>2017-06-23</td>
    </tr>
    <tr>
      <th>905</th>
      <td>2017-06-24</td>
    </tr>
    <tr>
      <th>906</th>
      <td>2017-06-25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We predict values with <code class="docutils literal notranslate"><span class="pre">Prophet</span></code> by passing in the dates for which we want to create a forecast. If we also supply the historical dates (as in our case), then in addition to the prediction we will get an in-sample fit for the history. Let’s call the model’s <code class="docutils literal notranslate"><span class="pre">predict</span></code> method with our <code class="docutils literal notranslate"><span class="pre">future</span></code> dataframe as an input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>trend</th>
      <th>yhat_lower</th>
      <th>yhat_upper</th>
      <th>trend_lower</th>
      <th>trend_upper</th>
      <th>additive_terms</th>
      <th>additive_terms_lower</th>
      <th>additive_terms_upper</th>
      <th>weekly</th>
      <th>weekly_lower</th>
      <th>weekly_upper</th>
      <th>yearly</th>
      <th>yearly_lower</th>
      <th>yearly_upper</th>
      <th>multiplicative_terms</th>
      <th>multiplicative_terms_lower</th>
      <th>multiplicative_terms_upper</th>
      <th>yhat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>904</th>
      <td>2017-06-23</td>
      <td>276.682485</td>
      <td>254.201087</td>
      <td>304.016830</td>
      <td>276.267332</td>
      <td>277.098510</td>
      <td>2.316748</td>
      <td>2.316748</td>
      <td>2.316748</td>
      <td>3.477219</td>
      <td>3.477219</td>
      <td>3.477219</td>
      <td>-1.160471</td>
      <td>-1.160471</td>
      <td>-1.160471</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>278.999233</td>
    </tr>
    <tr>
      <th>905</th>
      <td>2017-06-24</td>
      <td>277.388317</td>
      <td>218.637265</td>
      <td>267.275922</td>
      <td>276.948748</td>
      <td>277.834694</td>
      <td>-34.992533</td>
      <td>-34.992533</td>
      <td>-34.992533</td>
      <td>-34.025724</td>
      <td>-34.025724</td>
      <td>-34.025724</td>
      <td>-0.966809</td>
      <td>-0.966809</td>
      <td>-0.966809</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>242.395784</td>
    </tr>
    <tr>
      <th>906</th>
      <td>2017-06-25</td>
      <td>278.094149</td>
      <td>222.470485</td>
      <td>272.170684</td>
      <td>277.624320</td>
      <td>278.567768</td>
      <td>-31.355580</td>
      <td>-31.355580</td>
      <td>-31.355580</td>
      <td>-30.581870</td>
      <td>-30.581870</td>
      <td>-30.581870</td>
      <td>-0.773710</td>
      <td>-0.773710</td>
      <td>-0.773710</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>246.738569</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In the resulting dataframe you can see many columns characterizing the prediction, including trend and seasonality components as well as their confidence intervals. The forecast itself is stored in the <code class="docutils literal notranslate"><span class="pre">yhat</span></code> column.</p>
<p>The Prophet library has its own built-in tools for visualization that enable us to quickly evaluate the result.</p>
<p>First, there is a method called <code class="docutils literal notranslate"><span class="pre">Prophet.plot</span></code> that plots all the points from the forecast:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/eed11a86ee6c8c5f919dd459341bcbd8441930b310c3c7f57354bb3ca87c425f.png" src="../../_images/eed11a86ee6c8c5f919dd459341bcbd8441930b310c3c7f57354bb3ca87c425f.png" />
</div>
</div>
<p>This chart doesn’t look very informative. The only definitive conclusion that we can draw here is that the model treated many of the data points as outliers.</p>
<p>The second function <code class="docutils literal notranslate"><span class="pre">Prophet.plot_components</span></code> might be much more useful in our case. It allows us to observe different components of the model separately: trend, yearly and weekly seasonality. In addition, if you supply information about holidays and events to your model, they will also be shown in this plot.</p>
<p>Let’s try it out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">plot_components</span><span class="p">(</span><span class="n">forecast</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a86af3d5e44dd070a80826fd921fb8fa299ff15fba87989baafe5ccb7e454697.png" src="../../_images/a86af3d5e44dd070a80826fd921fb8fa299ff15fba87989baafe5ccb7e454697.png" />
</div>
</div>
<p>As you can see from the trend graph, Prophet did a good job by fitting the accelerated growth of new posts at the end of 2016. The graph of weekly seasonality leads to the conclusion that usually there are less new posts on Saturdays and Sundays than on the other days of the week. In the yearly seasonality graph there is a prominent dip on Christmas Day.</p>
</section>
<section id="forecast-quality-evaluation">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">3.5 Forecast quality evaluation</a><a class="headerlink" href="#forecast-quality-evaluation" title="Permalink to this heading">#</a></h3>
<p>Let’s evaluate the quality of the algorithm by calculating the error metrics for the last 30 days that we predicted. For this, we will need the observations <span class="math notranslate nohighlight">\(y_i\)</span> and the corresponding predicted values <span class="math notranslate nohighlight">\(\hat{y}_i\)</span>.</p>
<p>Let’s look into the object <code class="docutils literal notranslate"><span class="pre">forecast</span></code> that the library created for us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">forecast</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ds, trend, yhat_lower, yhat_upper, trend_lower, trend_upper, additive_terms, additive_terms_lower, additive_terms_upper, weekly, weekly_lower, weekly_upper, yearly, yearly_lower, yearly_upper, multiplicative_terms, multiplicative_terms_lower, multiplicative_terms_upper, yhat
</pre></div>
</div>
</div>
</div>
<p>We can see that this dataframe contains all the information we need except for the historical values. We need to join the <code class="docutils literal notranslate"><span class="pre">forecast</span></code> object with the actual values <code class="docutils literal notranslate"><span class="pre">y</span></code> from the original dataset <code class="docutils literal notranslate"><span class="pre">df</span></code>. For this we will define a helper function that we will reuse later:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">make_comparison_dataframe</span><span class="p">(</span><span class="n">historical</span><span class="p">,</span> <span class="n">forecast</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Join the history with the forecast.</span>

<span class="sd">       The resulting dataset will contain columns &#39;yhat&#39;, &#39;yhat_lower&#39;, &#39;yhat_upper&#39; and &#39;y&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">forecast</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">)[[</span><span class="s2">&quot;yhat&quot;</span><span class="p">,</span> <span class="s2">&quot;yhat_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;yhat_upper&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">historical</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s apply this function to our last forecast:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmp_df</span> <span class="o">=</span> <span class="n">make_comparison_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">cmp_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>yhat</th>
      <th>yhat_lower</th>
      <th>yhat_upper</th>
      <th>y</th>
    </tr>
    <tr>
      <th>ds</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-06-23</th>
      <td>278.999233</td>
      <td>254.201087</td>
      <td>304.016830</td>
      <td>421</td>
    </tr>
    <tr>
      <th>2017-06-24</th>
      <td>242.395784</td>
      <td>218.637265</td>
      <td>267.275922</td>
      <td>277</td>
    </tr>
    <tr>
      <th>2017-06-25</th>
      <td>246.738569</td>
      <td>222.470485</td>
      <td>272.170684</td>
      <td>253</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We are also going to define a helper function that we will use to gauge the quality of our forecasting with MAPE and MAE error measures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_forecast_errors</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prediction_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate MAPE and MAE of the forecast.</span>

<span class="sd">       Args:</span>
<span class="sd">           df: joined dataset with &#39;y&#39; and &#39;yhat&#39; columns.</span>
<span class="sd">           prediction_size: number of days at the end to predict.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make a copy</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Now we calculate the values of e_i and p_i according to the formulas given in the article above.</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;yhat&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

    <span class="c1"># Recall that we held out the values of the last `prediction_size` days</span>
    <span class="c1"># in order to predict them and measure the quality of the model.</span>

    <span class="c1"># Now cut out the part of the data which we made our prediction for.</span>
    <span class="n">predicted_part</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="n">prediction_size</span><span class="p">:]</span>

    <span class="c1"># Define the function that averages absolute error values over the predicted part.</span>
    <span class="n">error_mean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">error_name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">predicted_part</span><span class="p">[</span><span class="n">error_name</span><span class="p">]))</span>

    <span class="c1"># Now we can calculate MAPE and MAE and return the resulting dictionary of errors.</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;MAPE&quot;</span><span class="p">:</span> <span class="n">error_mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">),</span> <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">error_mean</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use our function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">err_name</span><span class="p">,</span> <span class="n">err_value</span> <span class="ow">in</span> <span class="n">calculate_forecast_errors</span><span class="p">(</span><span class="n">cmp_df</span><span class="p">,</span> <span class="n">prediction_size</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err_name</span><span class="p">,</span> <span class="n">err_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAPE 22.682514219134827
MAE 70.23342214773827
</pre></div>
</div>
</div>
</div>
<p>As a result, the relative error of our forecast (MAPE) is about 22.6%, and on average our model is wrong by ~70 posts (MAE).</p>
</section>
<section id="visualization">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">3.6 Visualization</a><a class="headerlink" href="#visualization" title="Permalink to this heading">#</a></h3>
<p>Let’s create our own visualization of the model built by Prophet. It will comprise the actual values, forecast and confidence intervals.</p>
<p>First, we will plot the data for a shorter period of time to make the data points easier to distinguish. Second, we will show the model performance only for the period that we predicted, that is the last 30 days. It seems that these two measures should give us a more legible plot.</p>
<p>Third, we will use <code class="docutils literal notranslate"><span class="pre">Plotly</span></code> to make our chart interactive, which is great for exploring.</p>
<p>We will define a custom helper function <code class="docutils literal notranslate"><span class="pre">show_forecast</span></code> and call it (for more on how it works please refer to the comments in the code and the <a class="reference external" href="https://plotly.com/python/">documentation</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">show_forecast</span><span class="p">(</span><span class="n">cmp_df</span><span class="p">,</span> <span class="n">num_predictions</span><span class="p">,</span> <span class="n">num_values</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize the forecast.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_go</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">cmp_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">create_go</span><span class="p">(</span>
        <span class="s2">&quot;Lower Bound&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yhat_lower&quot;</span><span class="p">,</span>
        <span class="n">num_predictions</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">create_go</span><span class="p">(</span>
        <span class="s2">&quot;Upper Bound&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yhat_upper&quot;</span><span class="p">,</span>
        <span class="n">num_predictions</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">),</span>
        <span class="n">fillcolor</span><span class="o">=</span><span class="s2">&quot;rgba(68, 68, 68, 0.3)&quot;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;tonexty&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">create_go</span><span class="p">(</span>
        <span class="s2">&quot;Forecast&quot;</span><span class="p">,</span> <span class="s2">&quot;yhat&quot;</span><span class="p">,</span> <span class="n">num_predictions</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgb(31, 119, 180)&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">create_go</span><span class="p">(</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">num_values</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">))</span>

    <span class="c1"># In this case the order of the series is important because of the filling</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">]</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Posts&quot;</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

    <span class="c1"># in a Jupyter Notebook, the following should work</span>
    <span class="c1">#iplot(fig, show_link=False)</span>

    <span class="c1"># in a Jupyter Book, we save a plot offline and then render it with IFrame</span>
    <span class="n">plot_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;../../_static/plotly_htmls/</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">show_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
    <span class="n">display</span><span class="p">(</span><span class="n">IFrame</span><span class="p">(</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">))</span>


<span class="n">show_forecast</span><span class="p">(</span><span class="n">cmp_df</span><span class="p">,</span> <span class="n">prediction_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;New posts on Medium&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="800"
            height="500"
            src="../../_static/plotly_htmls/New_posts_on_Medium.html"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p>At first glance, the prediction of the mean values by our model seems to be sensible. The high value of MAPE that we got above may be explained by the fact that the model failed to catch on to increasing peak-to-peak amplitude of weakly seasonality.</p>
<p>Also, we can conclude from the graph above that many of the actual values lie outside the confidence interval. Prophet may not be suitable for time series with unstable variance, at least when the default settings are used. We will try to fix this by applying a transform to our data.</p>
</section>
</section>
<section id="box-cox-transformation">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">4. Box-Cox Transformation</a><a class="headerlink" href="#box-cox-transformation" title="Permalink to this heading">#</a></h2>
<p>So far we have used Prophet with the default settings and the original data. We will leave the parameters of the model alone. But despite this we still have some room for improvement. In this section, we will apply the <a class="reference external" href="http://onlinestatbook.com/2/transformations/box-cox.html">Box–Cox transformation</a> to our original series. Let’s see where it will lead us.</p>
<p>A few words about this transformation. This is a monotonic data transformation that can be used to stabilize variance. We will use the one-parameter Box–Cox transformation, which is defined by the following expression:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
  boxcox^{(\lambda)}(y_{i}) = \begin{cases}
    \frac{\displaystyle y_{i}^{\lambda} - 1}{\displaystyle \lambda} &amp;, \text{if $\lambda \neq 0$}.\\
    ln(y_{i}) &amp;, \text{if $\lambda = 0$}.
  \end{cases}
\end{equation}
\end{split}\]</div>
<p>We will need to implement the inverse of this function in order to be able to restore the original data scale. It is easy to see that the inverse is defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{equation}
  invboxcox^{(\lambda)}(y_{i}) = \begin{cases}
    e^{\left (\frac{\displaystyle ln(\lambda y_{i} + 1)}{\displaystyle \lambda} \right )} &amp;, \text{if $\lambda \neq 0$}.\\
    e^{y_{i}} &amp;, \text{if $\lambda = 0$}.
  \end{cases}
\end{equation}
\end{split}\]</div>
<p>The corresponding function in Python is implemented as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">inverse_boxcox</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">lambda_</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">lambda_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we prepare our dataset by setting its index:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df2</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we apply the function <code class="docutils literal notranslate"><span class="pre">stats.boxcox</span></code> from <code class="docutils literal notranslate"><span class="pre">Scipy</span></code>, which applies the Box–Cox transformation. In our case it will return two values. The first one is the transformed series and the second one is the found value of <span class="math notranslate nohighlight">\(\lambda\)</span> that is optimal in terms of the maximum log-likelihood:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df2</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">lambda_prophet</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">train_df2</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="n">train_df2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We create a new <code class="docutils literal notranslate"><span class="pre">Prophet</span></code> model and repeat the fit-predict cycle that we have already done above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m2</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">()</span>
<span class="n">m2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df2</span><span class="p">)</span>
<span class="n">future2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">make_future_dataframe</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">prediction_size</span><span class="p">)</span>
<span class="n">forecast2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">future2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:55:27 - cmdstanpy - INFO - Chain [1] start processing
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16:55:27 - cmdstanpy - INFO - Chain [1] done processing
</pre></div>
</div>
</div>
</div>
<p>At this point, we need to revert the Box–Cox transformation with our inverse function and the known value of <span class="math notranslate nohighlight">\(\lambda\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;yhat&quot;</span><span class="p">,</span> <span class="s2">&quot;yhat_lower&quot;</span><span class="p">,</span> <span class="s2">&quot;yhat_upper&quot;</span><span class="p">]:</span>
    <span class="n">forecast2</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">inverse_boxcox</span><span class="p">(</span><span class="n">forecast2</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">lambda_prophet</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here we will reuse our tools for making the comparison dataframe and calculating the errors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmp_df2</span> <span class="o">=</span> <span class="n">make_comparison_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">err_name</span><span class="p">,</span> <span class="n">err_value</span> <span class="ow">in</span> <span class="n">calculate_forecast_errors</span><span class="p">(</span><span class="n">cmp_df2</span><span class="p">,</span> <span class="n">prediction_size</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err_name</span><span class="p">,</span> <span class="n">err_value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAPE 11.756308443357756
MAE 39.7806146830978
</pre></div>
</div>
</div>
</div>
<p>So, we can definitely state an increase in the quality of the model.</p>
<p>Finally, let’s plot our previous performance with the latest results side-by-side. Note that we use <code class="docutils literal notranslate"><span class="pre">prediction_size</span></code> for the third parameter in order to zoom in on the interval being predicted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_forecast</span><span class="p">(</span><span class="n">cmp_df</span><span class="p">,</span> <span class="n">prediction_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;No transformations&quot;</span><span class="p">)</span>
<span class="n">show_forecast</span><span class="p">(</span><span class="n">cmp_df2</span><span class="p">,</span> <span class="n">prediction_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Box–Cox transformation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="800"
            height="500"
            src="../../_static/plotly_htmls/No_transformations.html"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div><div class="output text_html">
        <iframe
            width="800"
            height="500"
            src="../../_static/plotly_htmls/Box–Cox_transformation.html"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p>We see that the forecast of weekly changes in the second graph is much closer to the real values now.</p>
</section>
<section id="summary">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">5. Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>We have taken a look at <em>Prophet</em>, an open-source forecasting library that is specifically targeted at business time series. We have also done some hands-on practice in time series prediction.</p>
<p>As we have seen, the Prophet library does not make wonders, and its predictions out-of-box are not <a class="reference external" href="https://en.wikipedia.org/wiki/No_free_lunch_in_search_and_optimization">ideal</a>. It is still up to the data scientist to explore the forecast results, tune model parameters and transform data when necessary.</p>
<p>However, this library is user-friendly and easily customizable. The sole ability to take into account abnormal days that are known to the analyst beforehand might make a difference in some cases.</p>
<p>All in all, the Prophet library is worth being a part of your analytical toolbox.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">6. References</a><a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Official <a class="reference external" href="https://github.com/facebook/prophet">Prophet repository</a> on GitHub.</p></li>
<li><p>Official <a class="reference external" href="https://facebook.github.io/prophet/docs/quick_start.html#python-api">Prophet documentation</a>.</p></li>
<li><p>Sean J. Taylor, Benjamin Letham <a class="reference external" href="https://facebook.github.io/prophet/static/prophet_paper_20170113.pdf">“Forecasting at scale”</a> — scientific paper explaining the algorithm which lays the foundation of <code class="docutils literal notranslate"><span class="pre">Prophet</span></code>.</p></li>
<li><p><a class="reference external" href="http://pbpython.com/prophet-overview.html">Forecasting Website Traffic Using Facebook’s Prophet Library</a> — <code class="docutils literal notranslate"><span class="pre">Prophet</span></code> overview with an example of website traffic forecasting.</p></li>
<li><p>Rob J. Hyndman, George Athanasopoulos <a class="reference external" href="https://www.otexts.org/fpp">“Forecasting: principles and practice”</a> – a very good online book about time series forecasting.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book/topic09"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="topic9_part1_time_series_python.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Topic 9. Part 1. Time series analysis in Python</p>
      </div>
    </a>
    <a class="right-next"
       href="videolecture09.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Videolecture 9. Time series: ARIMA and Prophet</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#article-outline">Article outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prophet-forecasting-model">2. The Prophet Forecasting Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trend">Trend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality">Seasonality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holidays-and-events">Holidays and Events</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error">Error</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prophet-benchmarking">Prophet Benchmarking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-with-facebook-prophet">3. Practice with Facebook Prophet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-in-python">3.1 Installation in Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">3.2 Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-visual-analysis">3.3 Exploratory visual analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-a-forecast">3.4 Making a forecast</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecast-quality-evaluation">3.5 Forecast quality evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">3.6 Visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#box-cox-transformation">4. Box-Cox Transformation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">5. Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">6. References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yury Kashnitsky (yorko)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>